# .travis.yml
language: rust
rust: [stable]
os: [linux, osx]

env:
  global:
    - CRATE_NAME=pet
  matrix:
    - TARGET=x86_64-unknown-linux-gnu
    - TARGET=x86_64-apple-darwin

# âœ… Make sure tags trigger builds
branches:
  only:
    - main
    - master
    - /^v\d+\.\d+\.\d+(-\S+)?$/   # v1.2.3 or v1.2.3-rc1

install:
  - rustup target add $TARGET

script:
  - cargo build --release --target $TARGET

before_deploy:
  - bash ci/package-travis.sh "$CRATE_NAME" "$TARGET" "$TRAVIS_OS_NAME"

deploy:
  provider: releases
  api_key: "$GITHUB_TOKEN"
  file_glob: true
  file: "release/*"
  draft: false
  skip_cleanup: true   # (legacy key; fine here)
  on:
    tags: true
